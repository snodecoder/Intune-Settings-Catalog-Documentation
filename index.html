<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Intune Settings Catalog</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    input, select { width: 100%; padding: 0.5em; font-size: 1em; margin-bottom: 1em; }
    pre { background: #f0f0f0; padding: 1em; border-radius: 8px; }
    .pagination { margin: 1em 0; }
    .pagination button { margin: 0 0.2em; }
    table { width: 100%; border-collapse: collapse; margin: 1em 0; }
    th, td { padding: 0.75em; text-align: left; border-bottom: 1px solid #ccc; }
    th { background: #f9f9f9; }
    tr.details-row { display: none; }
  </style>
</head>
<body>
  <h1>Intune Settings Catalog</h1>
  <label for="platformSelect">Platform:</label>
  <select id="platformSelect"><option value="">Select platform...</option></select>
  <label for="categorySelect">Category:</label>
  <select id="categorySelect"><option value="">All categories</option></select>
  <label for="keywordSelect">Keyword:</label>
  <select id="keywordSelect"><option value="">All keywords</option></select>
  <input type="text" id="searchInput" placeholder="Search for a setting...">
  <div id="results"></div>
  <div class="pagination" id="pagination"></div>

  <script>
    // Metadata
    let platforms = [];
    let categories = [];
    let keywords = [];
    // Data
    let index = [];
    let settings = [];
    let filtered = [];
    let currentPage = 1;
    const pageSize = 20;
    let currentPlatform = '';

    // Helper to update dropdown options
    function updateDropdown(sel, options, placeholder) {
      sel.innerHTML = '';
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = placeholder;
      sel.appendChild(opt);
      options.forEach(v => {
        const o = document.createElement('option');
        o.value = v;
        o.textContent = v;
        sel.appendChild(o);
      });
    }

    // Load metadata
    fetch('website_data/platforms.json').then(res => res.json()).then(data => {
      platforms = data;
      updateDropdown(document.getElementById('platformSelect'), platforms, 'Select platform...');
    });
    fetch('website_data/categories.json').then(res => res.json()).then(data => {
      categories = data;
      updateDropdown(document.getElementById('categorySelect'), categories, 'All categories');
    });
    fetch('website_data/keywords.json').then(res => res.json()).then(data => {
      keywords = data;
      updateDropdown(document.getElementById('keywordSelect'), keywords, 'All keywords');
    });

    // Event listeners
    document.getElementById('platformSelect').addEventListener('change', async function() {
      currentPlatform = this.value;
      if (!currentPlatform) {
        index = [];
        settings = [];
        filtered = [];
        updateDropdown(document.getElementById('categorySelect'), categories, 'All categories');
        updateDropdown(document.getElementById('keywordSelect'), keywords, 'All keywords');
        render();
        return;
      }
      // Load index and settings for selected platform
      [index, settings] = await Promise.all([
        fetch(`website_data/platforms/${currentPlatform}_index.json`).then(res => res.json()),
        fetch(`website_data/platforms/${currentPlatform}.json`).then(res => res.json())
      ]);
      // Extract available categories and keywords for this platform
      const cats = Array.from(new Set(index.map(i => i.categoryName).filter(Boolean))).sort();
      const kws = Array.from(new Set(index.flatMap(i => i.keywords || [])).values()).sort();
      updateDropdown(document.getElementById('categorySelect'), cats, 'All categories');
      updateDropdown(document.getElementById('keywordSelect'), kws, 'All keywords');
      currentPage = 1;
      filterAndRender();
    });
    document.getElementById('categorySelect').addEventListener('change', function() {
      // When category changes, update keywords for this platform+category
      const cat = this.value;
      let kws = [];
      if (cat) {
        kws = Array.from(new Set(index.filter(i => i.categoryName === cat).flatMap(i => i.keywords || []))).sort();
      } else {
        kws = Array.from(new Set(index.flatMap(i => i.keywords || []))).sort();
      }
      updateDropdown(document.getElementById('keywordSelect'), kws, 'All keywords');
      filterAndRender();
    });
    document.getElementById('keywordSelect').addEventListener('change', filterAndRender);
    document.getElementById('searchInput').addEventListener('input', filterAndRender);

    function filterAndRender() {
      const q = document.getElementById('searchInput').value.toLowerCase();
      const cat = document.getElementById('categorySelect').value;
      const kw = document.getElementById('keywordSelect').value;
      filtered = index.filter(s => {
        let match = true;
        if (q) {
          match = (s.settingName && s.settingName.toLowerCase().includes(q)) ||
                  (s.settingDescription && s.settingDescription.toLowerCase().includes(q));
        }
        if (match && cat) {
          match = s.categoryName === cat;
        }
        if (match && kw) {
          match = s.keywords && s.keywords.includes(kw);
        }
        return match;
      });
      currentPage = 1;
      render();
    }

    function render() {
      const container = document.getElementById('results');
      container.innerHTML = '';
      if (!filtered.length) {
        container.textContent = 'No results.';
        document.getElementById('pagination').innerHTML = '';
        return;
      }
      // Pagination
      const totalPages = Math.ceil(filtered.length / pageSize);
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageItems = filtered.slice(start, end);
      // Table
      const table = document.createElement('table');
      table.style.width = '100%';
      table.style.borderCollapse = 'collapse';
      const thead = document.createElement('thead');
      const headRow = document.createElement('tr');
      ['Setting Name', 'Category', 'Keywords', ''].forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        th.style.textAlign = 'left';
        th.style.borderBottom = '1px solid #ccc';
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      pageItems.forEach((s, idx) => {
        const full = settings.find(x => x.settingId === s.settingId) || s;
        const tr = document.createElement('tr');
        // Setting Name
        const tdName = document.createElement('td');
        tdName.textContent = full.settingName || full.displayName || '';
        tr.appendChild(tdName);
        // Category
        const tdCat = document.createElement('td');
        tdCat.textContent = full.categoryName || '';
        tr.appendChild(tdCat);
        // Keywords
        const tdKw = document.createElement('td');
        tdKw.textContent = (full.keywords || []).join(', ');
        tr.appendChild(tdKw);
        // Expand button
        const tdBtn = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = 'Show details';
        btn.style.cursor = 'pointer';
        btn.onclick = function() {
          if (detailsRow.style.display === 'none') {
            detailsRow.style.display = '';
            btn.textContent = 'Hide details';
          } else {
            detailsRow.style.display = 'none';
            btn.textContent = 'Show details';
          }
        };
        tdBtn.appendChild(btn);
        tr.appendChild(tdBtn);
        tbody.appendChild(tr);
        // Details row (hidden by default)
        const detailsRow = document.createElement('tr');
        detailsRow.style.display = 'none';
        const detailsTd = document.createElement('td');
        detailsTd.colSpan = 4;
        // Details as table
        const detailsTable = document.createElement('table');
        detailsTable.style.width = '100%';
        detailsTable.style.background = '#f9f9f9';
        detailsTable.style.border = '1px solid #eee';
        Object.entries(full).forEach(([k, v]) => {
          const row = document.createElement('tr');
          const keyTd = document.createElement('td');
          keyTd.textContent = k;
          keyTd.style.fontWeight = 'bold';
          keyTd.style.width = '200px';
          const valTd = document.createElement('td');
          if (typeof v === 'object' && v !== null) {
            valTd.textContent = JSON.stringify(v, null, 2);
            valTd.style.fontFamily = 'monospace';
          } else {
            valTd.textContent = v;
          }
          row.appendChild(keyTd);
          row.appendChild(valTd);
          detailsTable.appendChild(row);
        });
        detailsTd.appendChild(detailsTable);
        detailsRow.appendChild(detailsTd);
        tbody.appendChild(detailsRow);
      });
      table.appendChild(tbody);
      container.appendChild(table);
      // Pagination controls
      const pag = document.getElementById('pagination');
      pag.innerHTML = '';
      if (totalPages > 1) {
        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement('button');
          btn.textContent = i;
          if (i === currentPage) btn.disabled = true;
          btn.addEventListener('click', () => {
            currentPage = i;
            render();
          });
          pag.appendChild(btn);
        }
      }
    }
  </script>
</body>
</html>
